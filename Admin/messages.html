<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Chat Dashboard</title>
  <style>
    :root {
      --primary-color: #3498db;
      --success-color: #2ecc71;
      --danger-color: #e74c3c;
      --light-color: #ecf0f1;
      --dark-color: #2c3e50;
      --gray-color: #95a5a6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      padding: 20px;
      min-height: 100vh;
    }
    
    .chat-container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .chat-header {
      background-color: var(--primary-color);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chat-header h1 {
      font-size: 1.5rem;
    }
    
    .chat-status {
      background-color: white;
      color: var(--primary-color);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .chat-controls {
      padding: 15px 20px;
      background-color: var(--light-color);
      display: flex;
      gap: 10px;
    }
    
    .chat-controls input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .chat-controls button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    
    .chat-controls button:hover {
      background-color: #2980b9;
    }
    
    .messages-container {
      height: 500px;
      overflow-y: auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    
    .message {
      margin-bottom: 15px;
      padding: 12px 15px;
      border-radius: 8px;
      max-width: 80%;
      position: relative;
      line-height: 1.4;
    }
    
    .message-user {
      background-color: white;
      border: 1px solid #eee;
      margin-right: auto;
    }
    
    .message-admin {
      background-color: var(--primary-color);
      color: white;
      margin-left: auto;
    }
    
    .message-sender {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .message-time {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 5px;
      text-align: right;
    }
    
    .reply-area {
      padding: 15px 20px;
      background-color: white;
      border-top: 1px solid #eee;
      display: flex;
      gap: 10px;
    }
    
    .reply-area input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .reply-area button {
      background-color: var(--success-color);
      color: white;
      border: none;
      padding: 0 25px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    
    .reply-area button:hover {
      background-color: #27ae60;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: var(--gray-color);
    }
    
    .error {
      color: var(--danger-color);
      background-color: #fdecea;
      padding: 10px 15px;
      margin: 10px 20px;
      border-radius: 4px;
      display: none;
    }
    
    .chat-info {
      padding: 10px 20px;
      background-color: #f0f7fc;
      font-size: 0.9rem;
      color: var(--dark-color);
      display: flex;
      justify-content: space-between;
    }
    
    /* Scrollbar styling */
    .messages-container::-webkit-scrollbar {
      width: 8px;
    }
    
    .messages-container::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    .messages-container::-webkit-scrollbar-thumb {
      background: #bdc3c7;
      border-radius: 4px;
    }
    
    .messages-container::-webkit-scrollbar-thumb:hover {
      background: #95a5a6;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h1>Admin Chat Dashboard</h1>
      <div class="chat-status" id="chatStatus">Not Loaded</div>
    </div>
    
    <div class="chat-controls">
      <input type="text" id="chatIdInput" placeholder="Enter Chat ID" value="6895ed409cbf2ef6152c41ac">
      <button id="loadChatBtn">Load Chat</button>
    </div>
    
    <div class="error" id="errorMessage"></div>
    
    <div class="chat-info">
      <div>Chat ID: <span id="displayChatId">-</span></div>
      <div>Status: <span id="displayChatStatus">-</span></div>
    </div>
    
    <div class="messages-container" id="messagesContainer">
      <div class="loading" id="loadingIndicator">Enter a Chat ID and click "Load Chat"</div>
    </div>
    
    <div class="reply-area">
      <input type="text" id="messageInput" placeholder="Type your reply...">
      <button id="sendMessageBtn">Send</button>
    </div>
  </div>

  <script>
    const API_BASE = "https://lomu-dating-backend.onrender.com";
    const ADMIN_ID = "lomu";
    
    // DOM Elements
    const chatIdInput = document.getElementById('chatIdInput');
    const loadChatBtn = document.getElementById('loadChatBtn');
    const messagesContainer = document.getElementById('messagesContainer');
    const messageInput = document.getElementById('messageInput');
    const sendMessageBtn = document.getElementById('sendMessageBtn');
    const errorMessage = document.getElementById('errorMessage');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const chatStatus = document.getElementById('chatStatus');
    const displayChatId = document.getElementById('displayChatId');
    const displayChatStatus = document.getElementById('displayChatStatus');
    
    let currentChatId = '';
    
    // Format date to readable string
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 5000);
    }
    
    // Load chat messages
    async function loadChat() {
      const chatId = chatIdInput.value.trim();
      
      if (!chatId) {
        showError('Please enter a Chat ID');
        return;
      }
      
      try {
        loadingIndicator.textContent = 'Loading chat...';
        messagesContainer.innerHTML = '';
        messagesContainer.appendChild(loadingIndicator);
        
        const response = await fetch(`${API_BASE}/chat/${chatId}`);
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.message || 'Failed to load chat');
        }
        
        const chatData = await response.json();
        currentChatId = chatData.chatId;
        
        // Update chat info
        displayChatId.textContent = chatData.chatId;
        displayChatStatus.textContent = chatData.status || 'unknown';
        chatStatus.textContent = 'Loaded';
        chatStatus.style.color = 'var(--success-color)';
        
        // Display messages
        if (chatData.messages && chatData.messages.length > 0) {
          messagesContainer.innerHTML = '';
          
          chatData.messages.forEach(message => {
            const isAdmin = message.sender === ADMIN_ID;
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isAdmin ? 'message-admin' : 'message-user'}`;
            
            messageElement.innerHTML = `
              <div class="message-sender">${isAdmin ? 'Admin' : 'User'}</div>
              <div class="message-text">${message.message}</div>
              <div class="message-time">${formatDate(message.timestamp)}</div>
            `;
            
            messagesContainer.appendChild(messageElement);
          });
          
          // Scroll to bottom
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        } else {
          loadingIndicator.textContent = 'No messages in this chat';
          messagesContainer.innerHTML = '';
          messagesContainer.appendChild(loadingIndicator);
        }
      } catch (error) {
        console.error('Error loading chat:', error);
        showError(error.message);
        chatStatus.textContent = 'Error';
        chatStatus.style.color = 'var(--danger-color)';
      }
    }
    
    // Send message
    async function sendMessage() {
      const message = messageInput.value.trim();
      
      if (!currentChatId) {
        showError('Please load a chat first');
        return;
      }
      
      if (!message) {
        showError('Please enter a message');
        return;
      }
      
      try {
        sendMessageBtn.disabled = true;
        sendMessageBtn.textContent = 'Sending...';
        
        const response = await fetch(`${API_BASE}/api/chatAdmin/chat/:chatId`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chatId: currentChatId,
            adminId: ADMIN_ID,
            message: message
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.message || 'Failed to send message');
        }
        
        // Clear input and reload chat
        messageInput.value = '';
        await loadChat();
      } catch (error) {
        console.error('Error sending message:', error);
        showError(error.message);
      } finally {
        sendMessageBtn.disabled = false;
        sendMessageBtn.textContent = 'Send';
      }
    }
    
    // Event listeners
    loadChatBtn.addEventListener('click', loadChat);
    sendMessageBtn.addEventListener('click', sendMessage);
    
    // Load chat when Enter is pressed in chat ID input
    chatIdInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loadChat();
      }
    });
    
    // Send message when Enter is pressed in message input
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
    
    // Load the initial chat if ID is pre-filled
    if (chatIdInput.value.trim()) {
      loadChat();
    }
  </script>
</body>
</html>